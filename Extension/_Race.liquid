{% if Race.raceCode or Race.sdtc_raceCode -%}
    "extension":
    [
        {% assign raceCodes1 = Race.raceCode | to_array -%}
        {% assign raceCodes2 = Race.sdtc_raceCode | to_array -%}
        {% assign raceCodes = raceCodes1 | concat: raceCodes2 -%}
        {% for r in raceCodes -%}
            {
                {% if r.nullFlavor -%}
                    "url" : "ombCategory",
                    "valueCoding":
                    {
                        "system":"http://terminology.hl7.org/CodeSystem/v3-NullFlavor",
                        "code":"{{r.nullFlavor}}",
                        {% assign normalizedCode = r.nullFlavor | upcase -%}
                        {% if normalizedCode == 'ASKU' -%}
                            "display":"Asked but no answer",
                        {% else -%}
                            "display":"Unknown",
                        {% endif -%}
                    }
                {% else -%}
                    {% if r.code == '1002-5' or r.code == '2028-9' or r.code == '2054-5' or r.code == '2076-8' or r.code == '2106-3' -%}
                        "url" : "ombCategory",
                        {% assign raceSystem = 'http://hl7.org/fhir/us/core/ValueSet/omb-race-category|6.0.0-ballot' %}
                    {% else -%}
                        "url" : "detailed",
                        {% assign raceSystem = r.system %}
                    {% endif -%}
                    "valueCoding": { {% include 'DataType/Coding' Coding: r -%} }
                {% endif -%}
            }{% unless forloop.last %},{% endunless %}
        {% endfor -%}
    ],
{% endif -%}
{% if not Race.raceCode and not Race.sdtc_raceCode %}
    "extension":
    [
        {
            "url" : "ombCategory",
            "valueCoding":
            {
                "system":"http://terminology.hl7.org/CodeSystem/v3-NullFlavor",
                "code":"NI",
                "display":"Unknown"
            }
        },
        {
            "url" : "detailed",
            "valueCoding":
            {
                "system": "http://hl7.org/fhir/us/core/ValueSet/omb-race-category|6.0.0-ballot",
                "code": "UNK",
                "display": "Unknown"
            }
        }
    ],
{% endif -%}
{% if Race.sdtc_raceCode %}
    {
        "url": "text",
        "valueString": "Mixed"
    }
{% elsif Race.raceCode.nullFlavor %}
    {
        "url": "text",
        "valueString": {% if normalizedCode == 'ASKU' -%} "Asked but no answer" {% else -%} "Unknown" {% endif -%}
    }
{% else %}
    {
        "url": "text",
        "valueString": "{{Race.raceCode.coding[0].display}}"
    }
{% endif -%}
