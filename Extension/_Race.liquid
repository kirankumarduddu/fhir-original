{% if Race.raceCode -%}
  "url": "http://hl7.org/fhir/us/core/StructureDefinition/us-core-race",
  "extension":
  [
    {% assign raceCodes1 = Race.raceCode | to_array -%}
    {% assign raceCodes2 = Race.sdtc_raceCode | to_array -%}
    {% assign raceCodes = raceCodes1 | concat: raceCodes2 -%}
    {% for r in raceCodes -%}
      {
        {% if r.nullFlavor -%}
          "url": "ombCategory",
          "valueCoding":
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-NullFlavor",
            "code": "{{ r.nullFlavor }}",
            {% assign normalizedCode = r.nullFlavor | upcase -%}
            {% if normalizedCode == 'ASKU' -%}
              "display": "Asked but no answer",
            {% else -%}
              "display": "Unknown",
            {% endif -%}
          }
        {% else -%}
          {% assign ombCategory = false %}
          {% case r.code %}
            {% when '1002-5' %}
              {% assign ombCategory = true %}
              {% assign fhir_race_display = 'American Indian or Alaska Native' %}
            {% when '2028-9' %}
              {% assign ombCategory = true %}
              {% assign fhir_race_display = 'Asian' %}
            {% when '2054-5' %}
              {% assign ombCategory = true %}
              {% assign fhir_race_display = 'Black or African American' %}
            {% when '2076-8' %}
              {% assign ombCategory = true %}
              {% assign fhir_race_display = 'Native Hawaiian or Other Pacific Islander' %}
            {% when '2106-3' %}
              {% assign ombCategory = true %}
              {% assign fhir_race_display = 'White' %}
          {% endcase %}
          {% if ombCategory %}
            "url": "ombCategory",
          {% else %}
            "url": "detailed",
          {% endif %}
          "valueCoding": { {% include 'DataType/Coding' Coding: r -%} },
        {% endif -%}
      }{% unless forloop.last %},{% endunless %}
    {% endfor -%}
    {
      "url": "text",
      {% if Race.sdtc_raceCode -%}
        "valueString": "Mixed",
      {% elsif Race.raceCode.nullFlavor -%}
        {% assign normalizedCode = Race.raceCode.nullFlavor | upcase -%}
        {% if normalizedCode == 'ASKU' -%}
          "valueString": "Asked but no answer",
        {% else -%}
          "valueString": "Unknown",
        {% endif -%}
      {% else -%}
        "valueString": "{{ fhir_race_display }}",
      {% endif -%}
    }
  ],
{% endif -%}
